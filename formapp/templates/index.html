<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tabs</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    body {
      background-color: #f4f4f4;
    }

    .navbar {
      background-color: #3498db;
    }

    .navbar-brand,
    .nav-link {
      color: #ffffff;
    }

    .nav-tabs {
      background-color: #ecf0f1;
    }

    .nav-tabs .nav-item .nav-link {
      color: #0080ff;
    }

    .tab-pane {
      background-color: #67a7df;
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .nav {
      background-color: #c4e5fa;
    }

    .grid {
    background-color: #3498db;
    width: 100%;
    height: 430px;
    position: relative;
    border-radius: 20px;
  }

  .smaller-input {
    width: auto; 
    max-width: 80px; 
    min-width: 80px; 
    position: absolute;
    top: 0;
    left: 0; 
  }
  </style>
</head>

<body style="background-color: white;">
  <nav class="navbar navbar-expand-lg navbar-light">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Web components</a>
    </div>
  </nav>
  <div>
    <div class="container mt-3">
      <form id="projectForm" class="mb-3">
        <input id="searchInput" type="text" class="form-control mb-3 " placeholder="Search...">
        <input type="text" id="projectName" placeholder="Enter project name">
        <button type="submit">Submit</button>
        <span id="successMessage" class="bg-success"></span>
        <span id="errorMessage" class="bg-danger"></span>
      </form>
      <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item" role="presentation">
          <a class="nav-link active" data-bs-toggle="tab" href="#formCreation" aria-selected="true" role="tab">Form
            Creation Tab1</a>
        </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link" data-bs-toggle="tab" href="#alignment" aria-selected="false" role="tab">Alignment Tab2
          </a>
        </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link" data-bs-toggle="tab" href="#alignment2" aria-selected="false" role="tab">Empty Tab3
          </a>
        </li>
      </ul>

      <div class="tab-content mt-3">
        <div class="tab-pane fade show active mb-3" id="formCreation" role="tabpanel">
          <div id="formsContainer">
            <form class="dynamic-form" id="form1">
              <div class="row mb-3">
                <div class="col-md-3">
                  <label class="form-label">form 1</label>
                  <div class="input-group">
                    <input type="text" class="form-control size" placeholder="form1" />
                  </div>
                </div>
                <div class="col-md-3">
                  <label class="form-label">Redirect path</label>
                  <div class="input-group">
                    <input type="text" class="form-control size" placeholder="form1 Redirect Path" />
                    <button class="btn btn-danger ms-5 add-form" type="button">
                      +
                    </button>
                  </div>
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-md-7 dynamic-field">
                  <label class="form-label">Field name 1</label>
                  <label style="padding-left: 29%">Select option</label>
                  <div class="input-group">
                    <input type="text" class="form-control size" name="field1[]" placeholder="form1 Field name 1" />
                    <select class="form-select ms-1" name="selection1[]">
                      <option value="option1">varchar Field</option>
                      <option value="option2">Number Field</option>
                      <option value="option3">Password</option>
                      <option value="option4">Select box</option>
                      <option value="option5">Number Field</option>
                      <option value="option6">Email</option>
                      <option value="option7">Radio Button</option>
                      <option value="option8">Calc field</option>
                      <option value="option9">Check Box</option>
                      <option value="option10">image</option>
                      <option value="option11">logo</option>
                      <option value="option12">Comment box</option>
                      <option value="option13">Quantity box</option>
                      <option value="option14">Button</option>
                      <option value="option15">Tables</option>
                      <option value="option16">Video Field</option>
                      <option value="option17">File Field</option>
                      <option value="option18">Audio Field</option>
                    </select>
                    <div>
                      <label>
                        <input type="checkbox" class="checkbox" value="1" name="fooby[1][]" />Required</label>
                      <label>
                        <input type="checkbox" class="checkbox" value="1" name="fooby[1][]" />check 2</label>
                    </div>
                    <button class="btn btn-danger ms-5 add-field" type="button">
                      +
                    </button>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="col-md-12">
            <button id="submitBtn" class="btn btn-primary">Submit</button>
            <button type="button" class="btn btn-secondary ms-2 cancel-form">Cancel</button>
            <button type="reset" class="btn btn-danger ms-2">Reset</button>
          </div>
        </div>
        <div class="grid" id="emptyGrid">
          <input type="text" class="form-control form-control-sm mt-3 smaller-input" placeholder="Field"
            id="draggableInput" draggable="true" ondragstart="startDrag(event)">
        </div>
        

      </div>
    </div>
  </div>
    
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
  <script>
    $(document).ready(function () {
      var formCounter = 1;
      function generateFormHtml(formId) {
        return `
                    <form class="dynamic-form" id="${formId}">
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <label for="${formId}-forms" class="form-label">${formId}</label>
                                <div class="input-group">
                                    <input type="text" class="form-control size" id="${formId}-forms" placeholder="${formId}">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <label >Redirect path</label>
                                <div class="input-group">
                                    <input type="text" class="form-control size" id="${formId}-redirect" placeholder="${formId} Redirect Path">
                                    <button class="btn btn-danger ms-5 add-form" type="button">+</button>
                                </div>
                            </div>
                        </div>

                        
                        <div class="row mb-3">
                            <div class="col-md-7 dynamic-field">
                                <label >Field name 1</label><label style="padding-left :29%;">Select option</label>
                                <div class="input-group">
                                    <input type="text" class="form-control size" id="${formId}-field" name="${formId}-field1[]" placeholder="${formId} Field name 1">
                                    <select class="form-select ms-1" name="${formId}-selection1[]">
                                    <option value="option1">varchar Field</option> 
                                    <option value="option2">Number Field </option>
                                    <option value="option3">Password</option> 
                                    <option value="option4">Select box</option>
                                    <option value="option5">Number Field</option> 
                                    <option value="option6">Email</option>
                                    <option value="option7">Radio Button</option>
                                    <option value="option8">Calc field</option>
                                    <option value="option9">Check Box </option>
                                    <option value="option10">image</option>
                                    <option value="option11">logo</option>
                                    <option value="option12">Comment box</option> 
                                    <option value="option13">Quantity box</option>
                                    <option value="option14">Button </option>
                                    <option value="option15">Tables</option>
                                    <option value="option16">Video Field</option>
                                    <option value="option17">File Field</option> 
                                    <option value="option18">Audio Field</option>
                                </select>
                               <div>
                                    <label>
                                      <input type="checkbox" class="checkbox" value="1" name="${formId}-fooby[1][]" />Required</label>
                                    <label>
                                      <input type="checkbox" class="checkbox" value="1" name="${formId}-fooby[1][]" />check 2</label>                                       
                                  </div>
                                    <button class="btn btn-danger ms-5 add-field" type="button">+</button>
                                </div>
                            </div>
                        </div>
                    </form>
                `;
      }

      function addForm() {
        var newFormId = getNextFormNumber();
        var newFormHtml = generateFormHtml(newFormId);
        var newForm = $(newFormHtml);
        newForm
          .find(".add-form")
          .removeClass("add-form")
          .addClass("remove-form")
          .html("-");
        newForm.find('input[type="text"]').val("");
        newForm.find(".form-label").each(function (index) {
          var labelType =
            index === 0 ? "" : index === 1 ? "Redirect path" : "Field name";
          $(this).text(`${newFormId}  ${labelType} `);
        });
        $("#formsContainer").append(newForm);
      }

      function removeForm() {
        $(this).closest(".dynamic-form").remove();
      }
      $("#formsContainer").on("click", ".add-form", addForm);
      $("#formsContainer").on("click", ".remove-form", removeForm);
      function addField(formId, fieldCounter) {
        var newFieldId = "field" + fieldCounter;
        var fieldName = `${formId}-field${fieldCounter}`;

        while ($(`[name="${fieldName}[]"]`).length > 0) {
          fieldCounter++;
          newFieldId = "field" + fieldCounter;
          fieldName = `${formId}-field${fieldCounter}`;
        }

        var newField = `
                    <div class="row mb-3">
                        <div class="col-md-7 dynamic-field">
                            <label for="${newFieldId}" class="form-label">Field name ${fieldCounter} </label>
                            <div class="input-group">
                                <input type="text" class="form-control size" id="${formId}-${newFieldId}" name="${formId}-field${fieldCounter}[]" placeholder="${formId} Field name ${fieldCounter}">
                                <select class="form-select ms-1" name="${formId}-selection${fieldCounter}[]">
                                    <option value="option1">varchar Field</option> 
                                    <option value="option2">Number Field </option>
                                    <option value="option3">Password</option> 
                                    <option value="option4">Select box</option>
                                    <option value="option5">Number Field</option> 
                                    <option value="option6">Email</option>
                                    <option value="option7">Radio Button</option>
                                    <option value="option8">Calc field</option>
                                    <option value="option9">Check Box </option>
                                    <option value="option10">image</option>
                                    <option value="option11">logo</option>
                                    <option value="option12">Comment box</option> 
                                    <option value="option13">Quantity box</option>
                                    <option value="option14">Button </option>
                                    <option value="option15">Tables</option>
                                    <option value="option16">Video Field</option>
                                    <option value="option17">File Field</option> 
                                    <option value="option18">Audio Field</option>
                                </select>
                                <button class="btn btn-primary ms-5 remove-field" name="removebutton" type="button">-</button>
                            </div>
                        </div>
                    </div>
                `;

        $("#" + formId).append(newField);
      }

      function removeField() {
        $(this).closest(".row").remove();
      }

      $("#formsContainer").on("click", ".add-field", function () {
        var formId = $(this).closest(".dynamic-form").attr("id");
        var fieldCounter = $("#" + formId).find(".dynamic-field").length + 1;
        addField(formId, fieldCounter);
      });

      $("#formsContainer").on("click", ".remove-field", removeField);

      function getNextFormNumber() {
        var existingFormIds = $(".dynamic-form")
          .map(function () {
            return parseInt(this.id.replace("form", ""), 10);
          })
          .get();

        if (existingFormIds.length === 0) {
          return "form2";
        }

        var maxFormId = Math.max.apply(null, existingFormIds);
        return "form" + (maxFormId + 1);
      }

      $("#searchInput").on("keyup", function () {
        var value = $(this).val().toLowerCase();
        $(".dynamic-form").filter(function () {
          $(this).toggle($(this).attr('id').toLowerCase().indexOf(value) > -1)
        });
      });
    });
    document.getElementById("submitBtn")
      .addEventListener("click", function () { alert("Thank you for submitting!"); });

    $(document).ready(function () {
      $('#projectForm').submit(function (e) {
        e.preventDefault();
        var projectName = $('#projectName').val();
        $.ajax({
          type: 'POST',
          url: '/save_project/',
          data: {
            'project_name': projectName,
            'csrfmiddlewaretoken': '{{ csrf_token }}'
          },
          success: function (response) {
            $('#errorMessage').removeClass('bg-danger').addClass('bg-success').text(response.message);
            $('#projectName').val('');
            setTimeout(function () {
              $('#errorMessage').removeClass('bg-success').text('');
            }, 2000);
          },
          error: function (xhr, status, error) {
            console.error(xhr.responseText);
          }
        });
      });
      $('#projectName').blur(function () {
        var projectName = $(this).val();
        $.ajax({
          type: 'POST',
          url: '/validate_project_name/',
          data: {
            'project_name': projectName,
            'csrfmiddlewaretoken': '{{ csrf_token }}'
          },
          success: function (response) {
            if (response.exists) {
              $('#errorMessage').removeClass('bg-success').addClass('bg-danger').text('Project name already used!');
            } else {
              $('#errorMessage').removeClass('bg-danger bg-success').text('');
            }
          },
          error: function (xhr, status, error) {
            console.error(xhr.responseText);
          }
        });
      });
    });
    function startDrag(event) {
      event.dataTransfer.setData("text/plain", null);
    }

    const emptyGrid = document.getElementById("emptyGrid");

    emptyGrid.addEventListener("dragover", function (event) {
      event.preventDefault();
    });

    emptyGrid.addEventListener("drop", function (event) {
      event.preventDefault();
      const draggableInput = document.getElementById("draggableInput");
      const offsetX = event.clientX - emptyGrid.getBoundingClientRect().left;
      const offsetY = event.clientY - emptyGrid.getBoundingClientRect().top;
      draggableInput.style.left = offsetX + "px";
      draggableInput.style.top = offsetY + "px";
      emptyGrid.appendChild(draggableInput);
    });
  </script>
</body>

</html>